<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Functions</title>
<!--link rel="shortcut icon" href="../favicon.ico"-->
<link rel="stylesheet"
	href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css" />
<link rel="stylesheet" href="functions.css">
<script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
<script
	src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>

<script>
  function getUrlParam(param) {
    if (window.document.URL.indexOf("?") > 0) {
      var params = window.document.URL.substring(window.document.URL.indexOf("?") + 1).split("&");
      for (var i = 0; i < params.length; i++) {
        if (params[i].indexOf("=") > 0) {
          var spl = params[i].split("=");
          if (spl[0] === param) {
            return spl[1];
          }
        }
      }
    }
    return "";
  }

  function appendFunction(f) {
    var uid = getUrlParam("uid");
    var pre = "";
    var suff = "";
    var icon = "";
    switch (f.type) {
    case -100:
      pre = "Temperature";
      suff = "\xB0C";
      icon = "thermometer.png";
      break;
    case -101:
      pre = "Humidity"
      suff = "%";
      break;
    default:
      suff = "";
    }
    var li = $(document.createElement("li"));
    var a = $(document.createElement("a")).attr("href", "function.html?uid=" + uid + "&function=" + f.uid).attr(
        "target", "_self");
    var img = $(document.createElement("img")).attr("src", icon);
    var h2 = $(document.createElement("h2")).text(f.uid);
    var date = new Date(f.timestamp);
    var pStatus = $(document.createElement("p")).addClass("ui-li-aside").text(date.toLocaleString());
    var pFunction = $(document.createElement("p")).text(pre + ": " + f.value + suff);
    a.append(img);
    a.append(h2);
    a.append(pFunction);
    a.append(pStatus);
    li.append(a);
    li.appendTo($("#functionsList"));
    $("#functionsList").listview("refresh");
  }

  $(function() {
    var uid = getUrlParam("uid");
    if (uid !== "") {
      $.ajax("rest/devices/" + uid).done(function(data) {
        //alert("success: " + data);
        for (var i = 0; i < data.functions.length; i++) {
          appendFunction(data.functions[i]);
        }
      }).fail(function() {
        alert("error");
      });
      $("#deviceUid").text(uid);
    }
  });
</script>
</head>
<body>
	<div data-role="page" data-theme="b" id="demo-page" class="my-page">

		<div data-role="header">
			<h1 id="deviceUid">Device uid</h1>
			<a href="./" data-shadow="false" data-iconshadow="false"
				data-icon="carat-l" data-rel="back" data-ajax="false">Back</a>
		</div>
		<!-- /header -->

		<div role="main" class="ui-content">

			<ul id="functionsList" data-role="listview" data-inset="true"
				data-icon="false">
				<!--li><a href="#">
            	<img src="apple.png">
            	<h2>iOS 6.1</h2>
                <p>Apple released iOS 6.1</p>
                <p class="ui-li-aside">iOS</p>
            </a></li>
        	<li><a href="#">
            	<img src="blackberry_10.png">
            	<h2>BlackBerry 10</h2>
                <p>BlackBerry launched the Z10 and Q10 with the new BB10 OS</p>
                <p class="ui-li-aside">BlackBerry</p>
            </a></li-->
			</ul>

		</div>
		<!-- /content -->

	</div>
	<!-- /page -->

</body>
</html>